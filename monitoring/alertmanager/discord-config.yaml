apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: discord-webhook-config
  namespace: monitoring
spec:
  route:
    receiver: discord-webhook
    groupBy: ["job"]
    groupWait: 30s
    groupInterval: 5m
    repeatInterval: 1h
    matchers:
      - name: alertname
        value: Http5xxError|GoAPIErrorLogged|GoAPICriticalError|GoAPIPanicDetected
        matchType: "=~"
  receivers:
    - name: discord-webhook
      discordConfigs:
        - apiURL:
            name: dev-alarms-webhook-url
            key: webhook_url
          sendResolved: true
          title: '{{ template "discord.default.title" . }}'
          content: '{{ template "discord.default.message" . }}'
