---
image:
  tag: "v0.12.2"

metrics:
  enabled: true

config:
  registries:
  - name: "google"
    prefix: "asia-northeast3-docker.pkg.dev"
    api_url: "https://asia-northeast3-docker.pkg.dev"
    defaultns: "gramnuri-dev/gramnuri-repo"
    insecure: false
    default: true
    credentials: "ext:/scripts/gke-workload-identity-auth.sh" # Use external script

serviceAccount:
  create: true
  name: "argocd-image-updater"
  annotations:
    iam.gke.io/gcp-service-account: argocd-image-updater@gramnuri-dev.iam.gserviceaccount.com

authScripts:
  enabled: true
  scripts:
    gke-workload-identity-auth.sh: |
      #!/bin/sh
      ACCESS_TOKEN=$(wget --header 'Metadata-Flavor: Google' http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token -q -O - | grep -Eo '"access_token":.*?[^\\]",' | cut -d '"' -f 4)
      echo "oauth2accesstoken:$ACCESS_TOKEN"
